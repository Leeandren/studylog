<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Study Timer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { text-align: center; padding: 50px; }
    #sessionForm { display: none; }
    #timerDisplay { font-size: 2rem; margin: 20px; }
  </style>
</head>
<body>
  <h2>Hello <%= user.username %>, start your study session</h2>
  <button id="startBtn" class="btn btn-success">Start Session</button>
  <button id="endBtn" class="btn btn-danger" disabled>End Session</button>
  <div id="timerDisplay">0 min 0 sec</div>

  <!-- Form to submit after timer ends -->
  <form id="sessionForm" action="/studylog/timer" method="POST" class="container mt-4">
    <input type="hidden" name="study_date" value="<%= new Date().toISOString().split('T')[0] %>">
    <input type="hidden" name="duration" id="durationInput">

    <div class="form-group">
      <label>Topic:</label>
      <input type="text" name="topic" class="form-control" required>
    </div>
    <div class="form-group">
      <label>Notes:</label>
      <textarea name="notes" class="form-control" required></textarea>
    </div>
    <div class="form-group">
      <label>Mood:</label>
      <select name="mood" class="form-control" required>
        <option value="Happy">Happy</option>
        <option value="Focused">Focused</option>
        <option value="Tired">Tired</option>
        <option value="Distracted">Distracted</option>
      </select>
    </div>
    <button type="submit" class="btn btn-primary mt-3">Submit Session</button>
  </form>

  <script>
    let startTime, timerInterval;

    const startBtn = document.getElementById('startBtn');
    const endBtn = document.getElementById('endBtn');
    const timerDisplay = document.getElementById('timerDisplay');
    const sessionForm = document.getElementById('sessionForm');
    const durationInput = document.getElementById('durationInput');

    startBtn.addEventListener('click', () => {
      startTime = Date.now();
      startBtn.disabled = true;
      endBtn.disabled = false;
      timerInterval = setInterval(() => {
        const elapsed = Date.now() - startTime;
        const minutes = Math.floor(elapsed / 60000);
        const seconds = Math.floor((elapsed % 60000) / 1000);
        timerDisplay.textContent = `${minutes} min ${seconds} sec`;
      }, 1000);
    });

    endBtn.addEventListener('click', () => {
      clearInterval(timerInterval);
      const totalMins = Math.floor((Date.now() - startTime) / 60000);
      durationInput.value = totalMins;
      timerDisplay.textContent += ` â€” Duration: ${totalMins} minutes`;
      endBtn.disabled = true;
      sessionForm.style.display = 'block';
    });
  </script>
</body>
</html>
